<!DOCTYPE html><html><head><meta charset="utf-8"><style>html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }

body{
  color:#444;
  font-family:Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman',
              "Hiragino Sans GB", "STXihei", "微软雅黑", serif;
  font-size:12px;
  line-height:1.5em;
  background:#fefefe;
  width: 45em;
  margin: 10px auto;
  padding: 1em;
  outline: 1300px solid #FAFAFA;
}

a{ color: #0645ad; text-decoration:none;}
a:visited{ color: #0b0080; }
a:hover{ color: #06e; }
a:active{ color:#faa700; }
a:focus{ outline: thin dotted; }
a:hover, a:active{ outline: 0; }

span.backtick {
  border:1px solid #EAEAEA;
  border-radius:3px;
  background:#F8F8F8;
  padding:0 3px 0 3px;
}

::-moz-selection{background:rgba(255,255,0,0.3);color:#000}
::selection{background:rgba(255,255,0,0.3);color:#000}

a::-moz-selection{background:rgba(255,255,0,0.3);color:#0645ad}
a::selection{background:rgba(255,255,0,0.3);color:#0645ad}

p{
margin:1em 0;
}

img{
max-width:100%;
}

h1,h2,h3,h4,h5,h6{
font-weight:normal;
color:#111;
line-height:1em;
}
h4,h5,h6{ font-weight: bold; }
h1{ font-size:2.5em; }
h2{ font-size:2em; border-bottom:1px solid silver; padding-bottom: 5px; }
h3{ font-size:1.5em; }
h4{ font-size:1.2em; }
h5{ font-size:1em; }
h6{ font-size:0.9em; }

blockquote{
color:#666666;
margin:0;
padding-left: 3em;
border-left: 0.5em #EEE solid;
}
hr { display: block; height: 2px; border: 0; border-top: 1px solid #aaa;border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; }


pre , code, kbd, samp { 
  color: #000; 
  font-family: monospace; 
  font-size: 0.88em; 
  border-radius:3px;
  background-color: #F8F8F8;
  border: 1px solid #CCC; 
}
pre { white-space: pre; white-space: pre-wrap; word-wrap: break-word; padding: 5px 12px;}
pre code { border: 0px !important; padding: 0;}
code { padding: 0 3px 0 3px; }

b, strong { font-weight: bold; }

dfn { font-style: italic; }

ins { background: #ff9; color: #000; text-decoration: none; }

mark { background: #ff0; color: #000; font-style: italic; font-weight: bold; }

sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }

ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
li p:last-child { margin:0 }
dd { margin: 0 0 0 2em; }

img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; }

table { border-collapse: collapse; border-spacing: 0; }
td { vertical-align: top; }

@media only screen and (min-width: 480px) {
body{font-size:14px;}
}

@media only screen and (min-width: 768px) {
body{font-size:16px;}
}

@media print {
  * { background: transparent !important; color: black !important; filter:none !important; -ms-filter: none !important; }
  body{font-size:12pt; max-width:100%; outline:none;}
  a, a:visited { text-decoration: underline; }
  hr { height: 1px; border:0; border-bottom:1px solid black; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; padding-right: 1em; page-break-inside: avoid; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page :left { margin: 15mm 20mm 15mm 10mm; }
  @page :right { margin: 15mm 10mm 15mm 20mm; }
  p, h2, h3 { orphans: 3; widows: 3; }
  h2, h3 { page-break-after: avoid; }
}
</style><title>Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap</title></head><body><p>在侦查期间，扫描一直是信息收集的初始阶段。</p>
<h2 id="_1">什么是侦查</h2>
<p>侦查是尽可能多收集关于目标网络的信息。从黑客的角度来看，信息收集对于一次攻击非常有用，所以为了封锁恶意的企图，渗透测试者通常尽力查找这些信息，发现后修复这个缺陷。这也被叫做踩点。通过信息收集，人们通常会发现如下类型的信息：</p>
<ul>
<li>E-mail 地址</li>
<li>端口号/协议</li>
<li>操作系统信息</li>
<li>运行的服务</li>
<li>Traceroute 信息/DNS 信息</li>
<li>防火墙标识和绕过</li>
<li>其他</li>
</ul>
<p>所以对于信息收集，扫面是第一个部分。在扫面阶段，Nmap对于发现开放端口，协议号，操作系统信息，防火墙信息等是一个非常有用的工具。</p>
<h2 id="nmap">Nmap 介绍</h2>
<p>Nmap (网络映射器)是一个开源工具，它使网络探测和安全审计得以专业化。最初由 Gordon “Fyodor” Lyon 发布。官网官方网站是<a href="http://nmap.org">http://nmap.org</a>. Nmap是一个免费的用来实现网络探测和安全审计的开源程序。许多系统和网络管理员发现它对于一些日常的工作也有帮助。例如查看整个网络的信息，管理服务升级计划以及监控主机和服务的正常运行。</p>
<p>Nmap采用一种新颖的方式利用原始IP包来决定网络上是什么样的主机，这些主机提供什么样的服务（应用程序名和版本），它们运行着什么样的操作系统（操作系统版本）它们使用什么类型的过滤器/防火墙以及许多其他的特征。它虽然被设计用来快速扫描大型网络，但是在单个主机上也会工作的非常好。Nmap可以运行在所有的主流计算机操作系统上，Linux，Windows，Mac OS X都可以找到官方的安装包。</p>
<h2 id="nmap_1">安装Nmap</h2>
<p>Nmap 对于不同的环境有着非常好的支持。</p>
<p>Windows: 从官方网站安装 <a href="http://nmap.org">http://nmap.org</a>。windows上的所有图形用户界面和命令行都可以从官网上找到。Nmap的图形用户界面采用的是Zenmap。</p>
<p>Linux (Ubuntu and Debian): 在Linux终端上运行如下命令：<code>apt-get install nmap</code></p>
<p>如下的图片中，我已经安装好了Nmap。</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/1.png" /></p>
<p>基于Red Hat 和 Fedora 的系统: <code>yum install nmap</code></p>
<p>基于Gentoo Linux 的系统： <code>emerge nmap</code></p>
<p>接下来，我所有的操作将会用Linux终端来演示：</p>
<h2 id="nmap-scripting-engine">Nmap Scripting Engine</h2>
<p>The Nmap Scripting Engine (NSE) is one of Nmap’s most powerful and flexible features. It allows users to write (and share) simple scripts to automate a wide variety of networking tasks. Basically these scripts are written in Lua programming language. Generally Nmap’s script engine does lots of things, some of them are below:</p>
<p>Network discovery</p>
<p>This is Nmap’s bread and butter. Examples include looking up WhoIs data based on the target domain, querying ARIN, RIPE, or APNIC for the target IP to determine ownership, performing identd lookups on open ports, SNMP queries, and listing available NFS/SMB/RPC shares and services.</p>
<p>Vulnerability detection</p>
<p>When a new vulnerability is discovered, you often want to scan your networks quickly to identify vulnerable systems before the bad guys do. While Nmap isn’t a comprehensive vulnerability scanner, NSE is powerful enough to handle even demanding vulnerability checks. Many vulnerability detection scripts are already available, and they plan to distribute more as they are written.</p>
<p>Many attackers and some automated worms leave backdoors to enable later reentry. Some of these can be detected by Nmap’s regular expression-based version detection.</p>
<p>Vulnerability exploitation</p>
<p>As a general scripting language, NSE can even be used to exploit vulnerabilities rather than just find them. The capability to add custom exploit scripts may be valuable for some people (particularly penetration testers), though they aren’t planning to turn Nmap into an exploitation framework such as Metasploit.</p>
<p>As you can see below, I have used (-sc) options (or –script), which is a default script scan for the target network. You can see we got ssh, rpcbind, netbios-sn but the ports are either filtered or closed, so we can say that may be there are some firewall which is blocking our request. Later we will discuss how to identify firewalls and try to evade them.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/2.png" /></p>
<p>Now I m going to run a ping scan with discovery mode on (script) so that it will try all possible methods for scanning, that way I will get more juicy information.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/3.png" /></p>
<p>As you can see in the image, it is trying all possible methods as per script rules. See the next image for more information.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/4.png" /></p>
<p>Can you see the interesting ports and protocols? You can see dns-bruteforce found that host contains some blog, cms, sql, log, mail, and many more. So here we can perform SQL injection, the blog may be WordPress, Joomla, etc., so we can attack for a known CMS vulnerability, and obviously the method will be black-box pentesting.</p>
<p>In the upcoming chapter I will describe how to write your own Nmap script engine, and how to exploit them using Nmap.</p>
<h2 id="_2">基本的扫描技术</h2>
<p>接下来我将会演示一些基本的扫描技术。但是在那之前，你应该知道一些关于Nmap扫描后状态的的基本知识。</p>
<p>端口状态：扫描之后，你可能会看到一些端口状态如 open(开放的)，filtered(被过滤的)，closed(关闭的)等等。我来对此解释下。</p>
<ul>
<li>Open(开放的): 应用程序正在这个端口上监听连接。</li>
<li>Closed(关闭的): 端口对探测做出了响应，但是现在没有应用程序在监听这个端口。</li>
<li>Filtered(过滤的): 端口没有对探测做出响应。同时告诉我们探针可能被一些过滤器（防火墙）终止了。</li>
<li>Unfiltered(未被过滤的):端口对探测做出了响应，但是Nmap无法确定它们是关闭还是开放。</li>
<li>Open/Filtered: 端口被过滤或者是开放的，Nmap无法做出判断。</li>
<li>Closed/Filtered: 端口被过滤或者是关闭的，Nmap无法做出判断。</li>
</ul>
<h2 id="_3">开始扫描主机</h2>
<h2 id="_4">扫描单个网络</h2>
<p>在你的Nmap(Windows/Linux)上运行如下命令: <code>nmap 192.168.1.1(or) host name</code>。</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/5.png" /></p>
<h2 id="_5">扫描多个网络目标</h2>
<p>你可以用Nmap扫描多个目标来发现主机或者收集信息。</p>
<p>命令: map host1 host2 host3 etc….It will work for the entire subnet as well as different IP addresses.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/6.png" /></p>
<p>You can also scan multiple website/domain names at a time with the same command. See the below picture. It will convert the domain name to its equivalent IP address and scan the targets.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/7.png" /></p>
<h2 id="scan-a-range-of-ip-address">Scan a Range Of IP address</h2>
<p>Command:nmap 192.168.2.1-192.168.2.100</p>
<p>Nmap can also be used to scan an entire subnet using CIDR (Classless Inter-Domain Routing) notation.</p>
<h2 id="usage-syntax-nmap-networkcidr">Usage syntax: nmap [Network/CIDR]</h2>
<p>Ex:nmap 192.168.2.1/24</p>
<h2 id="scan-a-list-of-targets">Scan a list of targets</h2>
<p>If you have a large number of systems to scan, you can enter the IP address (or host names) in a text file and use that file as input for Nmap on the command line.</p>
<p>syntax: nmap -iL [list.txt]</p>
<h2 id="scan-random-targets">Scan Random Targets</h2>
<p>The -iR parameter can be used to select random Internet hosts to scan. Nmap will randomly generate the specified number of targets and attempt to scan them.</p>
<p>syntax: nmap -iR [number of host]</p>
<p>It is not a good habit to do a random scan unless you have been given some project.</p>
<h2 id="the-exclude-option-is-used-with-nmap-to-exclude-hosts-from-a-scan">The –exclude option is used with Nmap to exclude hosts from a scan.</h2>
<p>syntax: nmap [targets] –exclude [host(s)]</p>
<p>ex:nmap 192.168.2.1/24 –exclude 192.168.2.10</p>
<h2 id="aggressive-scan">Aggressive Scan</h2>
<p>The aggressive scan selects most commonly used options within Nmap to try to give a simple alternative to writing long strings. It will also work for traceroute, etc.</p>
<p>Command:nmap –A host</p>
<h2 id="discovery-with-nmap">Discovery With Nmap</h2>
<p>Discovery with Nmap is very interesting and very helpful for penetration testers. During discovery one can learn about services, port numbers, firewall presence, protocol, operating system, etc. We will discuss one by one.</p>
<h2 id="dont-ping">Don’t Ping</h2>
<p>The -PN option instructs Nmap to skip the default discovery check and perform a complete port scan on the target. This is useful when scanning hosts that are protected by a firewall that blocks ping probes.</p>
<p>Syntax:nmap –PN Target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/8.png" /></p>
<p>By specifying these options, Nmap will discover the open ports without ping, which is the unpingable system.</p>
<h2 id="ping-only-scan">Ping Only Scan</h2>
<p>The -Sp option is responsible for a ping only scan. It will be more useful when you have a group of IP addresses and you don’t know which one is reachable. By specifying a particular target, you can get even more information, like MAC address.</p>
<p>Syntax:nmap –Sp target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/9.png" /></p>
<h2 id="tcp-syn-scan">TCP Syn Scan</h2>
<p>Before we start, we must know the syn packet.</p>
<p>Basically a syn packet is used to initiate the connection between the two hosts.</p>
<p>The TCP SYN ping sends a SYN packet to the target system and listens for a response. This alternative discovery method is useful for systems that are configured to block standard ICMP pings.</p>
<p>The -PS option performs a TCP SYN ping.</p>
<p>Syntax:nmap –PS targets</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/10.png" /></p>
<p>The default port is port80. You can also specify other ports like –PS22, 23, 25, 443.</p>
<h2 id="tcp-ack-ping-scan">TCP Ack Ping Scan</h2>
<p>This type of scan will only scan of Acknowledgement(ACK) packet.</p>
<p>The -PA performs a TCP ACK ping on the specified target.</p>
<p>The -PA option causes Nmap to send TCP ACK packets to the specified hosts.</p>
<p>Syntax:nmap –PA target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/11.png" /></p>
<p>This method attempts to discover hosts by responding to TCP connections that are nonexistent in an attempt to solicit a response from the target. Like other ping options, it is useful in situations where standard ICMP pings are blocked.</p>
<h2 id="udp-ping-scan">UDP Ping scan</h2>
<p>The –PU scan only on udp ping scans on the target. This type of scan sends udp packets to get a response.</p>
<p>Syntax:nmap –PU target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/12.png" /></p>
<p>You can also specify the port number for scanning, like –PU 22, 80, 25, etc. In the above picture, the target is my LAN’s IP, which doesn’t have any UDP services.</p>
<h2 id="sctp-init-ping">Sctp init ping</h2>
<p>The -PY parameter instructs Nmap to perform an SCTP INIT ping. This option sends an SCTP packet containing a minimal INIT chunk. This discovery method attempts to locate hosts using the Stream Control Transmission Protocol (SCTP). SCTP is typically used on systems for IP based telephony.</p>
<p>Syntax:nmap –PY target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/13.png" /></p>
<p>In the picture, though there is no sctp services on the machine, we have to use the –pn option for discovery.</p>
<h2 id="icmp-echo-ping">ICMP Echo ping</h2>
<p>The -PE option performs an ICMP (Internet Control Message Protocol) echo ping on the specified system.</p>
<p>Syntax:nmap –PE target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/14.png" /></p>
<p>This type of discovery works best on local networks where ICMP packets can be transmitted with few restrictions.</p>
<h2 id="icmp-timestamp-ping">ICMP Timestamp ping</h2>
<p>The -PP option performs an ICMP timestamp ping.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/15.png" /></p>
<h2 id="icmp-address-mask-ping">ICMP Address mask ping</h2>
<p>The -PM option performs an ICMP address mask ping.</p>
<p>Syntax:nmap –PM target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/16.png" /></p>
<p>This unconventional ICMP query (similar to the -PP option) attempts to ping the specified host using alternative ICMP registers. This type of ping can occasionally sneak past a firewall that is configured to block standard echo requests.</p>
<h2 id="ip-protocol-ping">IP Protocol Ping</h2>
<p>The -PO option performs an IP protocol ping.</p>
<p>Syntax:nmap –PO protocol target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/17.png" /></p>
<p>An IP protocol ping sends packets with the specified protocol to the target. If no protocols are specified, the default protocols 1 (ICMP), 2 (IGMP), and 4 (IP-in-IP) are used.</p>
<h2 id="arp-ping">ARP ping</h2>
<p>The –PR option is used to perform an arp ping scan. The -PR option instructs Nmap to perform an ARP (Address Resolution Protocol) ping on the specified target.</p>
<p>SYTAX: nmap –PR target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/18.png" /></p>
<p>The -PR option is automatically implied when scanning the local network. This type of discovery is much faster than the other ping methods.</p>
<p>Traceroute</p>
<p>The –traceroute parameter can be use to trace the network path to the specified host.</p>
<p>Syntax: nmap –traceroute target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/19.png" /></p>
<h2 id="force-reverse-dns-resolution">Force Reverse DNS Resolution</h2>
<p>The -R parameter instructs Nmap to always perform a reverse DNS resolution on the target IP address.</p>
<p>Syntax: nmap –R target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/20.png" /></p>
<p>The -R option is useful when performing reconnaissance on a block of IP addresses, as Nmap will try to resolve the reverse DNS information of every IP address.</p>
<h2 id="disable-reverse-dns-resolution">Disable Reverse DNS Resolution</h2>
<p>The -n parameter is used to disable reverse DNS lookups.</p>
<p>Syntax:nmap –n target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/21.png" /></p>
<p>Reverse DNS can significantly slow an Nmap scan. Using the -n option greatly reduces scanning times – especially when scanning a large number of hosts. This option is useful if you don’t care about the DNS information for the target system and prefer to perform a scan which produces faster results.</p>
<h2 id="alternative-dns-lookup-method">Alternative DNS lookup method</h2>
<p>The –system-dns option instructs Nmap to use the host system’s DNS resolver instead of its own internal method.</p>
<p>Syntax:nmap –system-dns target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/22.png" /></p>
<h2 id="manually-specify-dns-server">Manually Specify DNS server</h2>
<p>The –dns-servers option is used to manually specify DNS servers to be queried when scanning.</p>
<p>Syntax: nmap –dns-servers server1 server2 target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/23.png" /></p>
<p>The –dns-servers option allows you to specify one or more alternative servers for Nmap to query. This can be useful for systems that do not have DNS configured or if you want to prevent your scan lookups from appearing in your locally configured DNS server’s log file.</p>
<h2 id="list-scan">List Scan</h2>
<p>The -sL option will display a list and performs a reverse DNS lookup of the specified IP addresses.</p>
<p>Syntax:nmap –sL target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/24.png" /></p>
<p>In the next installment, I will discuss how to discover services, host, and banners using different methods, and will also discuss how to find firewalls and how to evade them using NSE by Nmap, and how to write your own Nmap script engine. The most important part of Nmap is knowing how to find vulnerability and try to exploit them. Stay tuned.</p>
<h2 id="reference">Reference</h2>
<p>http://nmap.org/</p>
<p><em>via</em>：http://resources.infosecinstitute.com/nmap-cheat-sheet/</p>
<p><em>Copy:</em></p>
<p>As always during reconnaissance, scanning is the initial stage for information gathering.</p>
<h2 id="what-is-reconnaissance">What is Reconnaissance?</h2>
<p>Reconnaissance is to collect as much as information about a target network as possible. From a hacker’s perspective, the information gathered is very helpful to make an attack, so to block that type of malicious attempt, generally a penetration tester tries to find the information and to patch the vulnerabilities, if found. This is also called Footprinting. Usually by information gathering, someone can find the below information:</p>
<ul>
<li>E-mail Address</li>
<li>Port no/Protocols</li>
<li>OS details</li>
<li>Services Running</li>
<li>Traceroute information/DNS information</li>
<li>Firewall Identification and evasion</li>
<li>And many more…</li>
</ul>
<p>So for information gathering, scanning is the first part. For scanning, Nmap is a great tool for discovering Open ports, protocol numbers, OS details, firewall details, etc.</p>
<h2 id="introduction-to-nmap">Introduction To Nmap</h2>
<p>Nmap (Network Mapper) is an open-source tool that specializes in network exploration and security auditing, originally published by Gordon “Fyodor” Lyon. The official website is (http://nmap.org). Nmap is a free and open source (license) utility for network discovery and security auditing. Many systems and network administrators also find it useful for tasks such as network inventory, managing service upgrade schedules, and monitoring host or service uptime.</p>
<p>Nmap uses raw IP packets in novel ways to determine what hosts are available on the network, what services (application name and version) those hosts are offering, what operating systems (and OS versions) they are running, what type of packet filters/firewalls are in use, and dozens of other characteristics. It was designed to rapidly scan large networks, but works fine against single hosts. Nmap runs on all major computer operating systems, and official binary packages are available for Linux, Windows, and Mac OS X.</p>
<h2 id="installation-of-nmap">Installation Of Nmap</h2>
<p>Nmap has great support for different environments.</p>
<p>Windows: Install from the official site http://nmap.org For Windows, both GUI and command line options are available. The GUI option for Nmap is Zenmap.</p>
<p>Linux (Ubuntu and Debian): Fire the command in the Linux terminal: apt-get install nmap</p>
<p>In the below image, I have already installed Nmap.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/1.png" /></p>
<p>For Red Hat and Fedora based systems: yum install nmap</p>
<p>For Gentoo Linux based systems: emerge nmap</p>
<p>Here, I will show everything in the Linux terminal.</p>
<h2 id="nmap-scripting-engine_1">Nmap Scripting Engine</h2>
<p>The Nmap Scripting Engine (NSE) is one of Nmap’s most powerful and flexible features. It allows users to write (and share) simple scripts to automate a wide variety of networking tasks. Basically these scripts are written in Lua programming language. Generally Nmap’s script engine does lots of things, some of them are below:</p>
<p>Network discovery</p>
<p>This is Nmap’s bread and butter. Examples include looking up WhoIs data based on the target domain, querying ARIN, RIPE, or APNIC for the target IP to determine ownership, performing identd lookups on open ports, SNMP queries, and listing available NFS/SMB/RPC shares and services.</p>
<p>Vulnerability detection</p>
<p>When a new vulnerability is discovered, you often want to scan your networks quickly to identify vulnerable systems before the bad guys do. While Nmap isn’t a comprehensive vulnerability scanner, NSE is powerful enough to handle even demanding vulnerability checks. Many vulnerability detection scripts are already available, and they plan to distribute more as they are written.</p>
<p>Many attackers and some automated worms leave backdoors to enable later reentry. Some of these can be detected by Nmap’s regular expression-based version detection.</p>
<p>Vulnerability exploitation</p>
<p>As a general scripting language, NSE can even be used to exploit vulnerabilities rather than just find them. The capability to add custom exploit scripts may be valuable for some people (particularly penetration testers), though they aren’t planning to turn Nmap into an exploitation framework such as Metasploit.</p>
<p>As you can see below, I have used (-sc) options (or –script), which is a default script scan for the target network. You can see we got ssh, rpcbind, netbios-sn but the ports are either filtered or closed, so we can say that may be there are some firewall which is blocking our request. Later we will discuss how to identify firewalls and try to evade them.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/2.png" /></p>
<p>Now I m going to run a ping scan with discovery mode on (script) so that it will try all possible methods for scanning, that way I will get more juicy information.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/3.png" /></p>
<p>As you can see in the image, it is trying all possible methods as per script rules. See the next image for more information.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/4.png" /></p>
<p>Can you see the interesting ports and protocols? You can see dns-bruteforce found that host contains some blog, cms, sql, log, mail, and many more. So here we can perform SQL injection, the blog may be WordPress, Joomla, etc., so we can attack for a known CMS vulnerability, and obviously the method will be black-box pentesting.</p>
<p>In the upcoming chapter I will describe how to write your own Nmap script engine, and how to exploit them using Nmap.</p>
<h2 id="basic-scanning-techniques">Basic Scanning Techniques</h2>
<p>So here I will show the basic techniques for scanning network/host. But before that, you should know some basic stuff regarding Nmap status after scanning.</p>
<p>Port Status: After scanning, you may see some results with a port status like filtered, open, closed, etc. Let me explain this.</p>
<ul>
<li>Open: This indicates that an application is listening for connections on this port.</li>
<li>Closed: This indicates that the probes were received but there is no application listening on this port.</li>
<li>Filtered: This indicates that the probes were not received and the state could not be established. It also indicates that the probes are being dropped by some kind of filtering.</li>
<li>Unfiltered: This indicates that the probes were received but a state could not be established.</li>
<li>Open/Filtered: This indicates that the port was filtered or open but Nmap couldn’t establish the state.</li>
<li>Closed/Filtered: This indicates that the port was filtered or closed but Nmap couldn’t establish the state.</li>
</ul>
<h2 id="lets-scan-hosts">Let’s Scan Hosts</h2>
<h2 id="scan-a-single-network">Scan A Single Network</h2>
<p>Go to your Nmap (either Windows/Linux) and fire the command: nmap 192.168.1.1(or) host name.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/5.png" /></p>
<h2 id="scan-multiple-networktargets">Scan Multiple Network/Targets</h2>
<p>In Nmap you can even scan multiple targets for host discovery/information gathering.</p>
<p>Command: map host1 host2 host3 etc….It will work for the entire subnet as well as different IP addresses.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/6.png" /></p>
<p>You can also scan multiple website/domain names at a time with the same command. See the below picture. It will convert the domain name to its equivalent IP address and scan the targets.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/7.png" /></p>
<h2 id="scan-a-range-of-ip-address_1">Scan a Range Of IP address</h2>
<p>Command:nmap 192.168.2.1-192.168.2.100</p>
<p>Nmap can also be used to scan an entire subnet using CIDR (Classless Inter-Domain Routing) notation.</p>
<h2 id="usage-syntax-nmap-networkcidr_1">Usage syntax: nmap [Network/CIDR]</h2>
<p>Ex:nmap 192.168.2.1/24</p>
<h2 id="scan-a-list-of-targets_1">Scan a list of targets</h2>
<p>If you have a large number of systems to scan, you can enter the IP address (or host names) in a text file and use that file as input for Nmap on the command line.</p>
<p>syntax: nmap -iL [list.txt]</p>
<h2 id="scan-random-targets_1">Scan Random Targets</h2>
<p>The -iR parameter can be used to select random Internet hosts to scan. Nmap will randomly generate the specified number of targets and attempt to scan them.</p>
<p>syntax: nmap -iR [number of host]</p>
<p>It is not a good habit to do a random scan unless you have been given some project.</p>
<h2 id="the-exclude-option-is-used-with-nmap-to-exclude-hosts-from-a-scan_1">The –exclude option is used with Nmap to exclude hosts from a scan.</h2>
<p>syntax: nmap [targets] –exclude [host(s)]</p>
<p>ex:nmap 192.168.2.1/24 –exclude 192.168.2.10</p>
<h2 id="aggressive-scan_1">Aggressive Scan</h2>
<p>The aggressive scan selects most commonly used options within Nmap to try to give a simple alternative to writing long strings. It will also work for traceroute, etc.</p>
<p>Command:nmap –A host</p>
<h2 id="discovery-with-nmap_1">Discovery With Nmap</h2>
<p>Discovery with Nmap is very interesting and very helpful for penetration testers. During discovery one can learn about services, port numbers, firewall presence, protocol, operating system, etc. We will discuss one by one.</p>
<h2 id="dont-ping_1">Don’t Ping</h2>
<p>The -PN option instructs Nmap to skip the default discovery check and perform a complete port scan on the target. This is useful when scanning hosts that are protected by a firewall that blocks ping probes.</p>
<p>Syntax:nmap –PN Target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/8.png" /></p>
<p>By specifying these options, Nmap will discover the open ports without ping, which is the unpingable system.</p>
<h2 id="ping-only-scan_1">Ping Only Scan</h2>
<p>The -Sp option is responsible for a ping only scan. It will be more useful when you have a group of IP addresses and you don’t know which one is reachable. By specifying a particular target, you can get even more information, like MAC address.</p>
<p>Syntax:nmap –Sp target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/9.png" /></p>
<h2 id="tcp-syn-scan_1">TCP Syn Scan</h2>
<p>Before we start, we must know the syn packet.</p>
<p>Basically a syn packet is used to initiate the connection between the two hosts.</p>
<p>The TCP SYN ping sends a SYN packet to the target system and listens for a response. This alternative discovery method is useful for systems that are configured to block standard ICMP pings.</p>
<p>The -PS option performs a TCP SYN ping.</p>
<p>Syntax:nmap –PS targets</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/10.png" /></p>
<p>The default port is port80. You can also specify other ports like –PS22, 23, 25, 443.</p>
<h2 id="tcp-ack-ping-scan_1">TCP Ack Ping Scan</h2>
<p>This type of scan will only scan of Acknowledgement(ACK) packet.</p>
<p>The -PA performs a TCP ACK ping on the specified target.</p>
<p>The -PA option causes Nmap to send TCP ACK packets to the specified hosts.</p>
<p>Syntax:nmap –PA target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/11.png" /></p>
<p>This method attempts to discover hosts by responding to TCP connections that are nonexistent in an attempt to solicit a response from the target. Like other ping options, it is useful in situations where standard ICMP pings are blocked.</p>
<h2 id="udp-ping-scan_1">UDP Ping scan</h2>
<p>The –PU scan only on udp ping scans on the target. This type of scan sends udp packets to get a response.</p>
<p>Syntax:nmap –PU target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/12.png" /></p>
<p>You can also specify the port number for scanning, like –PU 22, 80, 25, etc. In the above picture, the target is my LAN’s IP, which doesn’t have any UDP services.</p>
<h2 id="sctp-init-ping_1">Sctp init ping</h2>
<p>The -PY parameter instructs Nmap to perform an SCTP INIT ping. This option sends an SCTP packet containing a minimal INIT chunk. This discovery method attempts to locate hosts using the Stream Control Transmission Protocol (SCTP). SCTP is typically used on systems for IP based telephony.</p>
<p>Syntax:nmap –PY target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/13.png" /></p>
<p>In the picture, though there is no sctp services on the machine, we have to use the –pn option for discovery.</p>
<h2 id="icmp-echo-ping_1">ICMP Echo ping</h2>
<p>The -PE option performs an ICMP (Internet Control Message Protocol) echo ping on the specified system.</p>
<p>Syntax:nmap –PE target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/14.png" /></p>
<p>This type of discovery works best on local networks where ICMP packets can be transmitted with few restrictions.</p>
<h2 id="icmp-timestamp-ping_1">ICMP Timestamp ping</h2>
<p>The -PP option performs an ICMP timestamp ping.</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/15.png" /></p>
<h2 id="icmp-address-mask-ping_1">ICMP Address mask ping</h2>
<p>The -PM option performs an ICMP address mask ping.</p>
<p>Syntax:nmap –PM target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/16.png" /></p>
<p>This unconventional ICMP query (similar to the -PP option) attempts to ping the specified host using alternative ICMP registers. This type of ping can occasionally sneak past a firewall that is configured to block standard echo requests.</p>
<h2 id="ip-protocol-ping_1">IP Protocol Ping</h2>
<p>The -PO option performs an IP protocol ping.</p>
<p>Syntax:nmap –PO protocol target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/17.png" /></p>
<p>An IP protocol ping sends packets with the specified protocol to the target. If no protocols are specified, the default protocols 1 (ICMP), 2 (IGMP), and 4 (IP-in-IP) are used.</p>
<h2 id="arp-ping_1">ARP ping</h2>
<p>The –PR option is used to perform an arp ping scan. The -PR option instructs Nmap to perform an ARP (Address Resolution Protocol) ping on the specified target.</p>
<p>SYTAX: nmap –PR target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/18.png" /></p>
<p>The -PR option is automatically implied when scanning the local network. This type of discovery is much faster than the other ping methods.</p>
<p>Traceroute</p>
<p>The –traceroute parameter can be use to trace the network path to the specified host.</p>
<p>Syntax: nmap –traceroute target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/19.png" /></p>
<h2 id="force-reverse-dns-resolution_1">Force Reverse DNS Resolution</h2>
<p>The -R parameter instructs Nmap to always perform a reverse DNS resolution on the target IP address.</p>
<p>Syntax: nmap –R target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/20.png" /></p>
<p>The -R option is useful when performing reconnaissance on a block of IP addresses, as Nmap will try to resolve the reverse DNS information of every IP address.</p>
<h2 id="disable-reverse-dns-resolution_1">Disable Reverse DNS Resolution</h2>
<p>The -n parameter is used to disable reverse DNS lookups.</p>
<p>Syntax:nmap –n target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/21.png" /></p>
<p>Reverse DNS can significantly slow an Nmap scan. Using the -n option greatly reduces scanning times – especially when scanning a large number of hosts. This option is useful if you don’t care about the DNS information for the target system and prefer to perform a scan which produces faster results.</p>
<h2 id="alternative-dns-lookup-method_1">Alternative DNS lookup method</h2>
<p>The –system-dns option instructs Nmap to use the host system’s DNS resolver instead of its own internal method.</p>
<p>Syntax:nmap –system-dns target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/22.png" /></p>
<h2 id="manually-specify-dns-server_1">Manually Specify DNS server</h2>
<p>The –dns-servers option is used to manually specify DNS servers to be queried when scanning.</p>
<p>Syntax: nmap –dns-servers server1 server2 target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/23.png" /></p>
<p>The –dns-servers option allows you to specify one or more alternative servers for Nmap to query. This can be useful for systems that do not have DNS configured or if you want to prevent your scan lookups from appearing in your locally configured DNS server’s log file.</p>
<h2 id="list-scan_1">List Scan</h2>
<p>The -sL option will display a list and performs a reverse DNS lookup of the specified IP addresses.</p>
<p>Syntax:nmap –sL target</p>
<p><img alt="" src="file://D:\novsec\Translation\Translating\Nmap Cheat Sheet From Discovery to Exploits – Part 1 Introduction to Nmap/./img/24.png" /></p>
<p>In the next installment, I will discuss how to discover services, host, and banners using different methods, and will also discuss how to find firewalls and how to evade them using NSE by Nmap, and how to write your own Nmap script engine. The most important part of Nmap is knowing how to find vulnerability and try to exploit them. Stay tuned.</p>
<h2 id="reference_1">Reference</h2>
<p>http://nmap.org/</p>
<p><em>via</em>：http://resources.infosecinstitute.com/nmap-cheat-sheet/</p></body></html>